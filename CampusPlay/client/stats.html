<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stats - CampusPlay</title>
  <link rel="stylesheet" href="css/stats.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
</head>

<body>
  <div class="page-wrapper">
    <aside class="sidebar">
      <div class="sidebar__logo">
        <i class="fas fa-gamepad"></i>
        <span>CampusPlay</span>
      </div>
      <nav class="sidebar__nav">
        <a href="index.html" class="nav-item"><i class="fas fa-home"></i> Dashboard</a>
        <a href="tournaments.html" class="nav-item"><i class="fas fa-trophy"></i> Tournaments</a>
        <a href="stats.html" class="nav-item active"><i class="fas fa-chart-area"></i> Stats</a>
        <a href="leaderboard.html" class="nav-item"><i class="fas fa-chart-bar"></i> Leaderboards</a>
      </nav>
      <div class="sidebar__footer">
        <a href="login.html" class="logout-button">Logout</a>
      </div>
    </aside>

    <main class="main-content">
      <header class="main-header">
        <div class="breadcrumbs">
          <span><a href="index.html">Games</a></span>
          <i class="fas fa-chevron-right"></i>
          <span>Stats</span>
        </div>

        <div class="header-actions">
          <div class="user-actions">
            <span class="notification-icon"><i class="fas fa-bell"></i></span>
            <div class="user-dropdown" id="user-dropdown">
              <span class="user-initials" id="user-initials">G</span>
              <span id="user-name" class="user-name"></span>
              <div class="dropdown-menu" id="dropdown-menu">
                <a href="#" class="dropdown-item" id="profile-link">Profile</a>
                <a href="login.html" class="dropdown-item" id="signout-link">Sign Out</a>
              </div>
            </div>
          </div>
        </div>
      </header>

      <div class="content-body">
        <section class="stats-section">
          <div class="stats-header">
            <h2><i class="fas fa-chart-line"></i> Tournament Statistics</h2>
          </div>

          <div class="stats-filters">
            <input type="text" id="statsSearchPlayer" placeholder="Search player name..." 
              style="padding: 10px 15px; border-radius: 6px; border: 1px solid #333; background: #222; color: white; flex: 1; max-width: 300px;" />
            <button id="statsFindMyPositionBtn" class="find-position-btn" 
              style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; white-space: nowrap;">
              <i class="fas fa-search"></i> Find My Position
            </button>
            <select id="statsFilterGame">
              <option value="">All Games</option>
              <option value="Valorant">Valorant</option>
              <option value="BGMI">BGMI</option>
              <option value="Clash Royale">Clash Royale</option>
              <option value="Top Tier">Top Tier</option>
            </select>
            <select id="statsFilterCampus">
              <option value="">All Campuses</option>
              <option value="Patiala">Patiala</option>
              <option value="Derabassi">Derabassi</option>
            </select>
            <button id="statsApplyBtn">Apply Filters</button>
            <button id="statsResetBtn" class="secondary">Reset</button>
            <button id="statsDeleteAllBtn" class="delete-all-btn"
              style="display: none; background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; margin-left: auto;">
              <i class="fas fa-trash-alt"></i> Delete All Stats
            </button>
          </div>

          <div class="stats-summary">
            <div class="summary-card">
              <div class="summary-value" id="sumPlayers">0</div>
              <div class="summary-label">Total Players</div>
            </div>
            <div class="summary-card">
              <div class="summary-value" id="sumWinRate">0%</div>
              <div class="summary-label">Avg Win Rate</div>
            </div>
            <div class="summary-card">
              <div class="summary-value" id="sumKD">0.00</div>
              <div class="summary-label">Avg K/D Ratio</div>
            </div>
            <div class="summary-card">
              <div class="summary-value" id="sumTopRating">0</div>
              <div class="summary-label">Top Rating</div>
            </div>
          </div>

          <div class="stats-table-wrapper">
            <table class="stats-table">
              <thead>
                <tr>
                  <th>Player</th>
                  <th>Campus</th>
                  <th>Game</th>
                  <th class="center">Matches</th>
                  <th class="center">Wins</th>
                  <th class="center">Avg Win Rate</th>
                  <th class="center">K/D</th>
                  <th class="center">Kills</th>
                  <th class="center">Deaths</th>
                  <th class="center">Assists</th>
                  <th class="center">Damage</th>
                  <th class="center">Headshots</th>
                  <th class="center">Top 10s</th>
                  <th class="center">Revives</th>
                  <th class="center">Distance</th>
                  <th class="center">Weapons</th>
                  <th class="center">Tier/Rating</th>
                  <th id="statsActionHeader" class="center" style="display: none;">Actions</th>
                </tr>
              </thead>
              <tbody id="statsTableBody">
                <tr>
                  <td colspan="17" class="small-muted">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="stats-admin-panel" id="statsAdminPanel" style="display: none">
            <h3><i class="fas fa-user-shield"></i> Admin Panel</h3>

            <div class="admin-section">
              <h4>CSV Upload</h4>
              <div class="csv-upload-area">
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                  <select id="statsUploadGame"
                    style="padding:8px; border-radius:6px; border:1px solid #333; background:#222; color:white;">
                    <option value="">Select Game (Default)</option>
                    <option value="Valorant">Valorant</option>
                    <option value="BGMI">BGMI</option>
                    <option value="Clash Royale">Clash Royale</option>
                    <option value="Free Fire">Free Fire</option>
                    <option value="COD Mobile">COD Mobile</option>
                  </select>
                  <select id="statsUploadCampus"
                    style="padding:8px; border-radius:6px; border:1px solid #333; background:#222; color:white;">
                    <option value="">Select Campus (Default)</option>
                    <option value="Patiala">Patiala</option>
                    <option value="Derabassi">Derabassi</option>
                  </select>
                </div>
                <div style="margin-bottom:10px;">
                  <label style="display:block; margin-bottom:5px; color:#aaa;">Replace Mode:</label>
                  <select id="statsReplaceMode"
                    style="padding:8px; border-radius:6px; border:1px solid #333; background:#222; color:white; width:100%;">
                    <option value="game-campus">Replace stats for same Game+Campus</option>
                    <option value="all">Replace ALL stats (delete everything first)</option>
                  </select>
                </div>
                <input type="file" id="statsCsvFile" accept=".csv" />
                <button id="statsParsePreviewBtn">Preview CSV</button>
                <button id="statsUploadBtn" disabled>
                  Upload to Database
                </button>
                <div class="admin-message" id="statsPreviewMsg"></div>
                <div class="csv-preview" id="statsPreviewWrap"></div>
              </div>
            </div>

            <div class="admin-section">
              <h4>Delete Stats</h4>
              <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                <button onclick="deleteAllStats()"
                  style="background:#e74c3c; color:white; border:none; padding:12px 24px; border-radius:6px; cursor:pointer; font-weight:600; font-size:14px;">
                  <i class="fas fa-trash-alt"></i> Delete All Stats (Current Filter)
                </button>
                <button onclick="deleteAllStatsConfirm()"
                  style="background:#c0392b; color:white; border:none; padding:12px 24px; border-radius:6px; cursor:pointer; font-weight:600; font-size:14px;">
                  <i class="fas fa-exclamation-triangle"></i> Delete ALL Stats (No Filter)
                </button>
                <p style="color:#aaa; font-size:12px; margin:5px 0; flex-basis:100%;">
                  <strong>Warning:</strong> "Delete All Stats (Current Filter)" will delete stats matching your current
                  filters.
                  "Delete ALL Stats" will delete everything regardless of filters. This action cannot be undone!
                </p>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <div class="toast-container" id="toast-container"></div>

  <script src="js/script.js"></script>
  <script src="js/stats.js"></script>
</body>

</html>